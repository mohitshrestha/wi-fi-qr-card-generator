// Print the entire webpage
function printQRCode() {
    window.print();
  }

/**
 * Display WiFi details below the QR code
 * @param {string} ssid - WiFi SSID
 * @param {string} password - WiFi password
 * @param {boolean} [showPassword=false] - Whether to show password
 */
function displayWifiDetails(ssid, password, showPassword = false) {
    const qrContainer = document.getElementById("qr-container");

    // Clear any previous details
    const existingSSID = document.querySelector("#qr-container .wifi-ssid");
    const existingPassword = document.querySelector("#qr-container .wifi-password");
    if (existingSSID) existingSSID.remove();
    if (existingPassword) existingPassword.remove();

    // SSID info
    const wifiDetailsSSID = document.createElement("p");
    wifiDetailsSSID.className = "wifi-ssid";
    wifiDetailsSSID.textContent = `Wi-Fi Name (SSID): ${ssid}`;
    qrContainer.appendChild(wifiDetailsSSID);

    // Show password if allowed
    if (showPassword && password) {
        const wifiDetailsPassword = document.createElement("p");
        wifiDetailsPassword.className = "wifi-password";
        wifiDetailsPassword.textContent = `Password: ${password}`;
        qrContainer.appendChild(wifiDetailsPassword);
    }
}

/**
 * Display "Generated by" and attribution info
 */
function displayBuildUsing() {
    const qrContainer = document.getElementById("qr-container");

    const buildUsingDetails = document.createElement("p");
    buildUsingDetails.className = "print-card-subtitle";
    buildUsingDetails.innerHTML = `
        Generated using <strong><a href="https://mohitshrestha.github.io/wi-fi-qr-card-generator/" target="_blank">Wi-Fi QR Card Generator</a></strong><br>
        Developed by <a href="https://mohitshrestha.com.np/" target="_blank">Mohit Shrestha</a><br> 
        Visit Website:<br>
        <a href="https://mohitshrestha.github.io/wi-fi-qr-card-generator/" target="_blank" style="font-size: 12px;">https://mohitshrestha.github.io/wi-fi-qr-card-generator/</a>
    `;

    qrContainer.appendChild(buildUsingDetails);
}


// Load JSON file and recreate the QR code
function importQRCodeFromJSON(file) {
    const reader = new FileReader();
  
    reader.onload = function (e) {
      const jsonConfig = JSON.parse(e.target.result);
  
      // Optional: Clear existing QR
      const qrContainer = document.getElementById("qr-container");
      qrContainer.innerHTML = `
        <p class='print-card-title'><i class='fa fa-wifi'></i> Wi-Fi Login Details</p>
        <p class='instructions'>ðŸ“± Point your phone's camera at the QR code to connect to WiFi automatically</p>
    `;
  
      // Create new QRCodeStyling instance from JSON
      const importedQRCode = new QRCodeStyling(jsonConfig);
      importedQRCode.append(qrContainer);

      // Extract SSID and password from QR data string
      const data = jsonConfig.data || "";
      const ssidMatch = data.match(/S:([^;]*)/);
      const passwordMatch = data.match(/P:([^;]*)/);

      const ssid = ssidMatch ? ssidMatch[1] : "(Not available)";
      const password = passwordMatch ? passwordMatch[1] : "";

    // Ask user if they want to show the password
    const showPassword = confirm("Do you want to display the Wi-Fi password?");

    // Display Wi-Fi info and attribution
      displayWifiDetails(ssid, password, showPassword);
      displayBuildUsing();
    };
  
    reader.readAsText(file);

  }

  function handleImportClick() {
    const fileInput = document.getElementById("import-json-input");
    if (fileInput.files.length > 0) {
      importQRCodeFromJSON(fileInput.files[0]);
    } else {
      alert("Please select a JSON file.");
    }
  }